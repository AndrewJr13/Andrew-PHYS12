<!DOCTYPE html>
<html lang="en">

<title>PHYS-12: Intro to Digital Fabrication </title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../style.css" rel="stylesheet">

<body style="background-color: black;">


<xmp theme="journal" style="display:none;">

  <br>
  <br>
  
  <head>Final Project Documentation</head>
  <br>
  <center>It has been a great semester for Digital Fabrication and to close it out, here is the Documentation
    for my final project. For my final, I created a gesture and proximity controlled locking system and implemented it 
    onto a small door. I mainly chose this project because I have always been intrested in automation and engineering applications
    to households. Growing up, my Dad would often design and implement home automation systems to turn off lights, adjust temperatures, and 
    control cameras outside the house. I always took intrest in these sort of things and was inspired to learn more. While a gesture lock isn't exactly 
    automation, the proximity lock part comes close. I decided to make the gesture lock after I found out about the sensor and thought it would be a really 
    cool project to do. I instantly reserved the sensor from Microcenter when I found out about it and started working after. My project uses a 16x2 Liquid Crystal 
    display, a 360 degree servo motor, a RBG 4-pin LED, and of course the Adafruit APDS9960 proximity and gesture sensor. So thank you to my classmates and instructors for 
    a great semester and here is my final project. 
  </center>

  <center> <iframe width="1000" height="600"
    src="https://www.youtube.com/embed/fVjSkdoy6QQ">
    </iframe> </center>
    <br>
    <br>
    <head>Initial Progress: Wiring</head>
    <br>
     To start the project off, I got my initial wiring and coding done. I first wired 
      my LCD display, sensor, and servo to my Arduino. Many connections went through the breadboard 
      and the wires were very messy and tangled which was the motive to make a box to contain them on the final 
      structure.
      <br> 
      <center>![](./wire12.png)</center>
      <br>
      <body>Before I knew it, it was time to mount my electronics. Using a very simple 3D design and taking measurements of my components, 
      I had a frame for all of my electronics. The LCD display would take up the main portion of the frame. The sensor was offset and mounted to 
      a small arm coming out from the main frame. My reasoning for this was to give the user room to gesture but also be able to see the output on the 
      LCD display. Below the display, a small hole would be origiinally dedicated to a button that would activate the system, but later I decided that I wanted
      the system to be activated with proximity. So instead of a button, I would fit an LED into the hole.</body>
      <br>
      <center>![](./lcd1.png)</center>
      <br>
      Pins soldered onto sensor and glue to structure to minimize messiness of wiring. 
      <br>
      <center>![](./sens1.png)</center>
      <br>
      And here is the finished wiring frame. 
      <br>
      <center>![](./frame1.png)</center>
      <br>
      <br>
      <br>
      <head>Next Steps: Coding</head>
      <br>
      First, I started off by initializing my LCD display. This was a very simple process. Using the LiquidCrystal constructor,
      I defined my rs, enable, D4, D5, D6, and D7 pins and the display was up and working just like that. 
  <pre><code class="language-arduino">
      LiquidCrystal lcd(8, 3, 4, 5, 6, 7);
  </code></pre>
      The only thing left to do was incorporate an analogWrite on pin 11 to adjust the constast of the display. On the actual LCD board, 
      the pin named V0 is the contrast controller. In my case, I connected V0 to pin 11 on my board. After that the last thing to do was to begin the display!
  <pre><code class="language-arduino">
    analogWrite(11, 140);
    lcd.begin(16, 2);
  </code></pre>
      Next, I decided to code the sensor and lock before I assembled the project. I already had the 
      electronics mounted and running so I started the coding process. First part of coding was getting the sensor the recognize gestures.
      Unfortunatley the Adafruit library that went with the sensor was not able to be used since it collided with the LiquidCrystal library. Even more 
      of a drawback was the fact that the only alternate library (SparkFun_APDS9960) was a bit more complicated. Mainly, the fact that the Adafruit library was able to use 
      if statements for the gestures. For example:
      <br>
  <pre><code class="language-arduino">
    if (DIR_RIGHT)
    {
      //Do this 
    }
  </code></pre>
      <br>
    Unfortunatley the Sparkfun library would not work with if statments. This was mainly due to the readGesture() method.
    This method was very confusing. After further research, I found out that the method returned an integer value. I soon was excited and 
    thought I could incorporate an if statement with the "==" binary operator if each direction returned a different integer. Unfortunatley this was not the case. 
    After further testing, I found the method returned 0 for every direction. Something that still confuses me to this day. So my last resort was to take a peek at the example code for the 
    gesture sensor and found out I would have to use a switch and cases. Switches and cases were something I was familiar with from my Java and Javascript experience but I never 
    really loved them. Unfortunatley it seemed this was the only way. The next step was to incorporate code for an interrupt. First I bound the 
    the interrupt to pin 2 on my Arduino, and set an interrupt flag. I also created my sensor object which i just called "apds."
  <pre><code class="language-arduino">
    #define APDS9960_INT 2
    int isr_flag = 0;
    SparkFun_APDS9960 apds = SparkFun_APDS9960();
    pinMode(APDS9960_INT, INPUT);
  </code></pre>
    Next I used Arduino's "attachInterrupt" method and a method that changes the interrupt flag
    called "interruptRoutine."
      <pre><code class="language-arduino">
    attachInterrupt(0, interruptRoutine, FALLING);
    void interruptRoutine() 
    {
      isr_flag = 1;
    }
  </code></pre>
    Next it was time to create the loop and incorporate the interrupt inside the loop. First, the loop 
    checks if isr_flag = 1 which it should throuh the interruptRoutine method which sets it to 1. Next, the program 
    detaches the Interrupt and resets isr_flag. I then implemented my main sequence there (I will get to that later), reset isr_flag, and then
    re-attached the interrupt. This sequence of code would mean that everytime I waved my hand in front of the sensor, my loop wold run my 
    gestureSequence() method which I will showcase later. 
  <pre><code class="language-arduino">
    if ( isr_flag == 1 ) {
      detachInterrupt(0);
      lcd.clear();
      gestureSequence();
      isr_flag = 0;
      attachInterrupt(0, interruptRoutine, FALLING);
  </code></pre>
    After creating the interrupt, I started working on the gestureSequence() method. First off was 
    an if statement using a method from the Sparkfun library. Very simple:
  <pre><code class="language-arduino">
    if ( apds.isGestureAvailable() ) {
  </code></pre>
    Next I created my switch. In my case, the switch will keep running the readGesture() method 
    until it matches it to a specific case. In each case, I cleared the LCD display, set the cursor so the text would be 
    centered then printed the direction corresponding to the gesture. For example, here is what the 
    DIR_UP case looked like. 
  <pre><code class="language-arduino">
    lcd.clear();
    cd.setCursor(7, 0);
    lcd.print("up");
    delay(500);
    break;
  </code></pre>  
    After this, my next step was to set up my servo and test it with just one gesture. Here's the simple
    setup code using the Servo library.
  <pre><code class="language-arduino">
    const int MTR_PIN = 12;
    lock.attach(MTR_PIN);
    lock.write(29); //starts in locked position when code is uploaded
  </code></pre>  
    


    


    

  

  

  [Back](../index.html).



</xmp>
</body>

<script src="https://strapdownjs.com/v/0.2/strapdown.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>

</html>